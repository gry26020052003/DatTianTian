<?php 
session_start();
echo '<html>
<head>
	<link rel="stylesheet" type="text/css" href="../includes/SSfonts.css" />
</head>
<body>';
require_once("../includes/sshdr.html");
require_once("../includes/bsa-conn.php");
require_once("../includes/functions.php");
if ( isset($_GET['cycle'])) 
	$cycle = $_GET['cycle'];
else
	$cycle = NULL;

if(isset($_GET['period'])) 
	$period = $_GET['period'];
else
	$period = NULL;
$cnt = 0;
echo'
<h1>Academic Planning Forms</h1>
<h2>'.$period.'for'.$cycle.'</h2>
<table>
	<tr>
		<th>Name</th>
    <th>Email</th>
    <th>Program</th>
    <th>Program Option</th>
    <th>APF Received</th>
	</tr>';
$query = "SELECT eap_ap.id AS eap_AP_Id, ucStudentID, lastName, firstName, nickname, cycle, participationYear, country, program, programOption, email, PhoneNumber_Home, PhoneNumber_Cell
	FROM eap_ap, eapprogramoptions, countries_eapdesignated
	WHERE eapprogramoptions.id = eap_ap.eapProgramOptions_Id 
	AND countries_eapdesignated.id = eapprogramoptions.countries_EAPDesignated_Id 
	AND cycle = '" . $cycle . "' 
	AND period = '" . $period . "'
	AND extendedFrom_eap_AP_Id Is Null 
	ORDER BY lastName, firstName";

$result = mysql_query($query);

if ($result)
	$num_rows = mysql_num_rows($result);
else
	$num_rows = 0;

for ($i = 0; $i < $num_rows; $i++) 
{
	$row = mysql_fetch_array($result);
	$eap_AP_Id = $row['eap_AP_Id'];
	$lastName = displayText($row['lastName']);
	$firstName = displayText($row['firstName']);
	$email = displayText($row['email']);
	$program = displayText($row['program']);
	$programOption = displayText($row['programOption']);

	$query2 = "SELECT status
		  FROM eap_ap_eapstatuses, eapstatuses
		  WHERE eap_AP_Id = " . $eap_AP_Id . "
		  AND eapstatuses.id = eap_ap_eapstatuses.eapStatuses_Id
		  ORDER BY effectiveDate DESC
		  LIMIT 1";

	$result2 = mysql_query($query2);
	
	if ($result2)
		$num_rows2 = mysql_num_rows($result2);
	else
		$num_rows2 = 0;

	for($i2 = 0; $i2 < $num_rows2; $i2++) 
	{
		$row2 = mysql_fetch_array($result2);
		$status = $row2['status'];
	}
 //end for
	if ($status == "Selected") 
	{
echo '<tr>
	<td>'.$lastName.','.$firstName.'</td>
	<td>'.$email.'</td>
	<td>'.$program.'</td>
	<td>'.$programOption.'</td>            
	<td>';
	$query3 = "SELECT dateReceived
					   FROM apf
					   WHERE eap_AP_Id = " . $eap_AP_Id . "";
	$result3 = mysql_query($query3);
	if($result3) 
		$num_rows3 = mysql_num_rows($result3);
	else
		$num_rows3 = 0;

	for ($i3 = 0; $i3 < $num_rows3; $i3++) 
	{
		$row3 = mysql_fetch_array($result3);	
		$dateReceived = displayDate($row3['dateReceived']);
		$cnt++ ;
	} //end for
echo '</td>            
</tr>';
	} 
} //end foreach
echo'</tr>
</table>
<p>Count: <?php echo $cnt; ?></p>
</body>
</html>';
